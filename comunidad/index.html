<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>

<head>
    <title>Perfil</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./../css/bootstrap.css">
    <link rel="stylesheet" href="./../css/principal.css">
    <link rel="stylesheet" href="./../css/comunidad.css">

    <!-- <style>
        body {
          width: 5000px;
        }
        </style> -->
</head>

<body>

    <header>
        <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
            <a class="navbar-brand" href="index.html">
                <img src="/img/reforest.png" height="30" alt="log-reforest" title="logo-reforest">
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="container-fluid ">
                <div class="collapse navbar-collapse justify-content-center" id="navbarSupportedContent">

                    <ul class="navbar-nav align-items-center">
                        <li class="nav-item active">
                            <a class="nav-link" href="index.html">Inicio
                                <span class="sr-only">(current)</span></a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="profile.html">perfil</a>
                        </li>
                    </ul>

                </div>
                <ul class="navbar-nav align-items-end">
                    <li class="nav-item">
                        <a class="nav-link" href="profile.html">
                            <div>
                                <img src="../img/perfil_1.jpg" width="40px" alt="imagen" class="rounded-circle">
                            </div>
                        </a>
                    </li>
                </ul>
            </div>

        </nav>
    </header>


    <div style="padding-top:105px;">
    </div>

    <div class="container">
        <div id="perfil-usuario" class="row">
            <div class="col-md-4 col-12">
                <div id="tarjeta-perfil" class="row shadow-sm d-none d-sm-block ">
                    <div id="banner-perfil" class="col-12"></div>
                    <div class="col-12">
                        <div class="row">
                            <div id="imagen-perfil" class="col-3 text-center">
                                <!-- <img src="/img/perfil_1.jpg" width="70px" alt="imagen" class="rounded-circle"
                                    style=" border: 2.5px #ffffff solid"> -->
                            </div>
                            <div id="datos-perfil" class="col-9">
                                <span id="usuario" class="usuario"></span>
                                <span class="nivel" style="">Nivel 5</span>
                                <div class="estadisticas">
                                    <div class="progress">
                                        <div class="progress-bar bg-primary" role="progressbar" style="width: 15%"
                                            aria-valuenow="15" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </div>
                                <span class="puntos" style="">30,00 puntos</span>
                            </div>
                        </div>
                    </div>

                    <!--div class="col-12 text-center" style="">
                            <div class="row">
                                <div class="col">
                                    <p class="" style="
                                       margin-block-start: 0px;
                                       margin-block-end: 0px;
                                       ">Arboles</p>
                                    <p class=""style="
                                       margin-block-start: 0px;
                                       margin-block-end: 0px;
                                       ">5</p>
                                </div>
                                <div class="col">
                                    <p class=""style="
                                       margin-block-start: 0px;
                                       margin-block-end: 0px;
                                       ">Donaciones</p>
                                    <p class=""style="
                                       margin-block-start: 0px;
                                       margin-block-end: 0px;
                                       ">1</p>
                                </div>
                                <div class="col" style="
                                     margin-bottom: 10px">
                                    <p class=""style="
                                       margin-block-start: 0px;
                                       margin-block-end: 0px;
                                       ">Campa√±as</p>
                                    <p class=""style="
                                       margin-block-start: 0px;
                                       margin-block-end: 0px;
                                       ">1</p>
                                </div>
                            </div>
                        </div-->
                </div>
            </div>

            <div class="col-md-8 col-12" style="border: solid; padding-bottom: 200px;">
                Chat

                <div id="content" style="height: 100%; overflow: auto">

                    <div class="card" style="width: 18rem;">
                        <ul class="list-group list-group-flush" style="height: 100%; overflow: auto" id="chatUl">


                            <div class="card" style="width: 18rem;">
                                <ul class="list-group list-group-flush" id="chatUl">

                                </ul>
                            </div>
                    </div>

                    <!-- <div class="type_msg">
                    <div class="input_msg_write">
                      <input type="text" class="write_msg" placeholder="Type a message" />
                      <button class="msg_send_btn" type="button"><i class="fa fa-paper-plane-o" aria-hidden="true"></i></button>
                    </div>
                  </div> -->






<!-- 
    Componer
                    <div class="container-fluid">
                        <footer class="bg-light bg" style="height: 50;">
                            <div class="container">
                                <ul class="nav justify-content-center">
                                    <li class="nav-item align-self-center">
                                        <a class="nav-link active" href="index.html">
                                            <img src="img/reforest.png" height="24">
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </footer>
                    </div> -->

                    <!-- <ul id="chatUl">
                    <li>
                <b>Nombre: </b> Mensaje
            </li>
            <li>
                <b>Nombre: </b> Mensaje
            </li>
                </ul> -->

                </div>
            </div>
        </div>

        <!-- Footer -->

    <div class="container-fluid fixed-bottom">
        <footer class="bg-light bg" style="height: 50;">
            <div class="container">

                    <!-- <form class="form-inline my-2 my-lg-0">
                            <input id="nombre" class="form-control mr-sm-2" type="text" placeholder="Nombre" aria-label="Nombre">
                            <input id="mensaje" class="form-control mr-sm-2" type="text" placeholder="Mensaje" aria-label="Search">
                            <button id="btnEnviar" class="btn btn-outline-success my-2 my-sm-0" type="submit">Enviar</button>
                    </form> -->

                <ul class="nav justify-content-center">
                    <li class="nav-item align-self-center">
                        <div>
                            <label for="nombre">Nombre</label>
                            <input type="text" id="nombre">
                        </div>
                    </li>
                    <li class="nav-item align-self-center">
                        <div>
                            <label for="mensaje">Mensaje</label>
                            <input type="text" id="mensaje">
                        </div>
                    </li>
                    <li>
                        <button type="button" id="btnEnviar">Enviar</button>
                    </li>
                </ul>

            </div>
        </footer>
    </div>




<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/7.1.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.1.0/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.1.0/firebase-auth.js"></script>

        <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->

    <script>
        // Your web app's Firebase configuration
        var firebaseConfig = {
            apiKey: "AIzaSyB4CgA911BNu-K3Irkymn9y127Rr3Chml8",
            authDomain: "reforest-cc105.firebaseapp.com",
            databaseURL: "https://reforest-cc105.firebaseio.com",
            projectId: "reforest-cc105",
            storageBucket: "",
            messagingSenderId: "949319571597",
            appId: "1:949319571597:web:44be13746ff7d5b3"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        var txtNombre = document.getElementById('nombre');
        var txtMensaje = document.getElementById('mensaje');
        var btnEnviar = document.getElementById('btnEnviar');
        var chatUl = document.getElementById('chatUl');
        var usuarioUl = document.getElementById('usuario');



        if (firebase.auth().currentUser !== null) {
            // var user_cur = firebase.auth().currentUser.uid;
            // console.log("user id: " + user_cur);
            // firebase.database().ref('usuario').child(user_cur).once('value').then(function(snapshot) {
            //     var html = '';
            // var nombre = (snapshot.val() && snapshot.val().nombre) || 'Anonymous';
            // html = "<span>" + nombre + "</span>";
            // // document.getElementById('usuario').value = "";
            // usuarioUl.innerHTML = html;
            // });
            var userId = firebase.auth().currentUser.uid;
            firebase.database().ref('usuario').child(userId).once('value').then(function(snapshot) {
                var html = '';
                snapshot.forEach(function (e) {
                    var elemet = e.val();
                    var nombre = elemet.nombre;

                    html = "<span>" + nombre + "</span>";                

                });
            usuarioUl.innerHTML = html;
            });
         }
        firebase.database().ref('chat')
            .on('value', function (snapshot) {
                var html = '';
                var html_na = '';
                snapshot.forEach(function (e) {
                    var elemet = e.val();
                    var nombre = elemet.nombre;
                    var mensaje = elemet.mensaje;

                    html += "<li class=\"list-group-item\"><b>" + nombre + "<br> </b>" + mensaje + "</li>";
                    window.scrollTo(0, 200);
                });
                chatUl.innerHTML = html;
                window.scrollTo(0, 20000);
            });

        btnEnviar.addEventListener('click', function () {
            var nombre = txtNombre.value;
            var mensaje = txtMensaje.value;
            // var html = "<li><b>" + nombre + ": </b>" + mensaje + "</li>";
            // chatUl.innerHTML += html;

            firebase.database().ref('chat').push({
                userId: firebase.auth().currentUser.uid,
                nombre: nombre,
                mensaje: mensaje
            });
            var html = '';

                html = "<span>" + nombre + "</span>";
                document.getElementById('mensaje').value = "";
                usuarioUl.innerHTML = html;


                window.scrollTo(0, 20000);

            });

    



    </script>



        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
            integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
            crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
            integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
            crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
            integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
            crossorigin="anonymous"></script>

</body>

</html>